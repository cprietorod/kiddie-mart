
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Reto 7: Resolver Bug en Load State</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14" ga4id=""></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  codelab-ga4id=""
                  id="fix-load-state-bug"
                  title="Reto 7: Resolver Bug en Load State"
                  environment="web"
                  feedback-link="https://github.com/cprietorod/kiddie-mart/issues">
    
      <google-codelab-step label="Introducci√≥n" duration="1">
        <p>¬°Es hora de hacer debugging con AI! En este reto, usar√°s Gemini CLI para encontrar y corregir un bug real en la carga del estado de la aplicaci√≥n.</p>
<h2 is-upgraded>El problema</h2>
<p>Al abrir la app por primera vez, <strong>los productos no se cargan correctamente</strong>. A veces la lista aparece vac√≠a y los productos predeterminados no se muestran.</p>
<h2 is-upgraded>Lo que aprender√°s</h2>
<ul>
<li>C√≥mo describir bugs de forma precisa a Gemini CLI</li>
<li>C√≥mo usar AI para analizar l√≥gica de estado y encontrar errores</li>
<li>Flujo de debugging: describir s√≠ntoma ‚Üí localizar archivo ‚Üí encontrar causa ‚Üí aplicar fix ‚Üí verificar</li>
</ul>
<h2 is-upgraded>Lo que necesitas</h2>
<ul>
<li>La app corriendo en modo desarrollo</li>
<li>Gemini CLI configurado con <code>GEMINI.md</code></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Reproducir el bug" duration="1">
        <p>Primero, vamos a confirmar el bug:</p>
<ol type="1">
<li>Abre la app en <strong>http://localhost:9002</strong></li>
<li>Entra como <strong>Staff</strong></li>
<li>Observa la lista de productos</li>
</ol>
<p>El comportamiento esperado es ver una lista de productos con iconos, nombres y precios. Pero podr√≠as ver:</p>
<ul>
<li>Una lista vac√≠a</li>
<li>Un mensaje de &#34;no hay productos&#34;</li>
</ul>
<h2 is-upgraded>Limpiar IndexedDB para reproducir</h2>
<p>Si la app ya tiene datos en cach√©, limpia IndexedDB para reproducir el bug de primera carga:</p>
<ol type="1">
<li>Abre DevTools (<code>F12</code> o <code>Cmd+Opt+I</code>)</li>
<li>Ve a <strong>Application</strong> ‚Üí <strong>IndexedDB</strong></li>
<li>Borra la base de datos <code>KiddieMartDB</code></li>
<li>Recarga la p√°gina</li>
</ol>
<p>Negative : El bug est√° relacionado con la carga inicial de datos. Si los datos ya est√°n en IndexedDB de una sesi√≥n anterior, el bug podr√≠a no ser visible inmediatamente.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Pedir ayuda a Gemini CLI" duration="1">
        <p>Ahora, p√≠dele a Gemini CLI que analice el problema:</p>
<pre><code language="language-bash" class="language-bash">gemini &#34;Hay un bug en la aplicaci√≥n: cuando se abre por primera vez 
(sin datos en IndexedDB), los productos no se cargan y la lista 
aparece vac√≠a. 

El problema est√° en la carga del estado inicial. Revisa:
1. src/context/KiddieMartContext.tsx - la funci√≥n loadData
2. src/lib/indexedDbService.ts - la funci√≥n getAllProducts

Busca problemas en c√≥mo se manejan los valores de retorno de 
las funciones de IndexedDB, especialmente cuando la DB est√° vac√≠a.&#34;
</code></pre>
<h2 is-upgraded>Lo que Gemini deber√≠a encontrar</h2>
<p>Gemini CLI analizar√° el c√≥digo y deber√≠a identificar que hay un problema con c√≥mo se maneja el valor de retorno de <code>getAllProducts()</code>. Espec√≠ficamente:</p>
<ul>
<li><code>getAllProducts()</code> retorna un array vac√≠o <code>[]</code> cuando no hay productos</li>
<li>Pero en <code>loadData</code>, el resultado se transforma de una manera que impide que el seeding (carga de datos iniciales) funcione correctamente</li>
</ul>
<p>Positive : Observa c√≥mo un prompt con contexto espec√≠fico (nombre de archivo, nombre de funci√≥n, s√≠ntoma) produce un diagn√≥stico mucho m√°s preciso que simplemente decir &#34;la app no funciona&#34;.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Entender la causa ra√≠z" duration="1">
        <p>Pide a Gemini que te explique la causa ra√≠z en detalle:</p>
<pre><code language="language-bash" class="language-bash">gemini &#34;Expl√≠came en detalle la causa ra√≠z del bug en loadData. 
¬øQu√© l√≠nea exacta causa el problema y por qu√©? 
Mu√©strame el flujo de datos paso a paso.&#34;
</code></pre>
<h2 is-upgraded>La causa ra√≠z</h2>
<p>El bug es sutil. En la funci√≥n <code>loadData()</code>:</p>
<ol type="1">
<li><code>getAllProducts()</code> retorna <code>[]</code> (array vac√≠o) cuando la DB est√° vac√≠a</li>
<li>Pero el c√≥digo usa <code>|| undefined</code> que convierte <code>[]</code> a <code>undefined</code> (porque <code>[]</code> es truthy, esto en realidad no cambia <code>[]</code>... ¬øo s√≠?)</li>
<li>El array vac√≠o <code>[]</code> es <strong>truthy</strong> en JavaScript, as√≠ que <code>[] || undefined</code> sigue siendo <code>[]</code></li>
<li><strong>Pero espera</strong> ‚Äî el problema real es que <code>?.length</code> con optional chaining cambia la l√≥gica de seeding</li>
</ol>
<p>El c√≥digo deber√≠a verificar <code>dbProducts.length === 0</code> directamente, no usar optional chaining que permite que <code>undefined</code> pase silenciosamente.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Aplicar el fix" duration="1">
        <p>Pide a Gemini que aplique la correcci√≥n:</p>
<pre><code language="language-bash" class="language-bash">gemini &#34;Corrige el bug en la funci√≥n loadData de 
src/context/KiddieMartContext.tsx. 
El fix debe:
1. Manejar correctamente el caso cuando getAllProducts retorna un array vac√≠o
2. Asegurar que el seeding de productos iniciales funcione
3. No cambiar el comportamiento cuando ya hay productos en la DB&#34;
</code></pre>
<h2 is-upgraded>Verificar el fix</h2>
<p>Despu√©s de que Gemini aplique el cambio:</p>
<ol type="1">
<li>Abre DevTools ‚Üí <strong>Application</strong> ‚Üí <strong>IndexedDB</strong></li>
<li>Borra <code>KiddieMartDB</code></li>
<li>Recarga la p√°gina</li>
<li>Los productos deber√≠an aparecer correctamente üéâ</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Reflexi√≥n" duration="1">
        <h2 is-upgraded>¬øQu√© aprendimos sobre debugging con AI?</h2>
<ol type="1">
<li><strong>Describir el s√≠ntoma claramente</strong> ‚Äî &#34;productos no cargan&#34; es mejor que &#34;no funciona&#34;</li>
<li><strong>Dar pistas sobre d√≥nde buscar</strong> ‚Äî indicar archivos y funciones espec√≠ficas</li>
<li><strong>Pedir explicaci√≥n de la causa ra√≠z</strong> ‚Äî no solo el fix, sino el &#34;por qu√©&#34;</li>
<li><strong>Verificar siempre</strong> ‚Äî aplicar el fix y probar que resuelve el problema</li>
</ol>
<h2 is-upgraded>T√©cnicas de prompting para debugging</h2>
<table>
<tr><td colspan="1" rowspan="1"><p>T√©cnica</p>
</td><td colspan="1" rowspan="1"><p>Ejemplo</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Describir s√≠ntoma</p>
</td><td colspan="1" rowspan="1"><p>&#34;Los productos no se cargan al inicio&#34;</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Localizar c√≥digo</p>
</td><td colspan="1" rowspan="1"><p>&#34;Revisa loadData en KiddieMartContext.tsx&#34;</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Dar contexto t√©cnico</p>
</td><td colspan="1" rowspan="1"><p>&#34;Usa IndexedDB, la DB empieza vac√≠a&#34;</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Pedir paso a paso</p>
</td><td colspan="1" rowspan="1"><p>&#34;Mu√©strame el flujo de datos&#34;</p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="¬°Felicitaciones!" duration="0">
        <p>üéâ ¬°Has completado el Reto 7!</p>
<h2 is-upgraded>Lo que aprendiste</h2>
<ul>
<li>C√≥mo hacer debugging efectivo con Gemini CLI</li>
<li>C√≥mo escribir prompts de debugging precisos</li>
<li>La importancia de reproducir, diagnosticar y verificar</li>
</ul>
<h2 is-upgraded>Lo que corregiste</h2>
<ul>
<li>Bug en <code>loadData()</code> que imped√≠a la carga de productos iniciales</li>
</ul>
<h2 is-upgraded>Siguiente paso</h2>
<p>Contin√∫a con el <strong>Reto 8: Resolver Problema de Margin</strong> ‚Äî otro bug visual espera tu diagn√≥stico.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
